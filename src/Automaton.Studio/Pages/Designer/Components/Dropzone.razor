@using Automaton.Studio.Domain;
@using System.Text
@implements IDisposable

<div class="@GetClassesForDropzone()" 
     @ondragover:preventDefault
     @ondragover="()=> { }"
     @ondragenter:preventDefault
     @ondragenter="()=>OnDragEnter()"
     @ondrop="()=>OnDrop()"
     @onmousedown="()=>DropzoneMouseDown()"
     @onclick="()=>DropzoneClick()"
     @ondrop:preventDefault
     @ondrop:stopPropagation
     @ondragenter:stopPropagation
     @ondragend:stopPropagation
     @ondragover:stopPropagation
     @ondragleave:stopPropagation
     @ondragstart:stopPropagation
     ondragstart="event.dataTransfer.setData('text', event.target.id);">

    <div @ondrop="()=>OnDropItemOnSpacing(0)"
         @ondrop:stopPropagation
         @ondragenter="()=>OnDragItemOnFirstSpacing()"
         @ondragleave="()=>OnDragLeaveItemFromFirstSpacing()"
         class="@GetStepSpacerClass(null)">
    </div>

    @foreach (var item in Items)
    {
        <div draggable="@IsItemDragable(item)"
         @ondragstart="()=>OnDragStart(item)"
         @ondragend="()=>OnDragEnd()"
         @ondragenter="()=>OnItemDragEnter(item)"
         @ondragleave="()=>OnDragLeave()"
         @onclick="()=>ItemClick(item)"
         @ondblclick="()=>ItemDoubleClick(item)" @ondblclick:stopPropagation="true"
         @onmousedown="()=>ItemMouseDown(item)" @onmousedown:stopPropagation="true"
         class="@GetClassesForDraggable(item) @CheckIfItemIsInTransit(item) @CheckIfItemIsDragTarget(item) @CheckIfDragOperationIsInProgess() @CheckIfDraggable(item)">

            @{
                if (ChildContent != null)
                {
                    @ChildContent(item)
                    ;
                }
            }
        </div>

        <div @ondrop="()=>OnDropItemOnSpacing(Items.IndexOf(item)+1)"
         @ondrop:stopPropagation
         @ondragenter="()=>OnDragItemOnSpacing(item)"
         @ondragleave="()=>OnDragLeaveItemFromSpacing(item)"
         class="@GetStepSpacerClass(item)">
        </div>
    }

</div>

<style>

    .dropzone {
        overflow: auto;
        height: calc(100vh - 115px);
    }

    .step-active-spacing {
        height: 15px;
        background-color: deepskyblue
    }

    .step-spacing {
        height: 15px;
    }

</style>