@using Automaton.Studio.Models
@using Automaton.Studio.Resources
@inherits FeedbackComponent<NewWorkflowModel>

<Form @ref="form"
      Model="@workflowModel"
      LabelColSpan="4"
      WrapperColSpan="20"
      >
    <Validator>
        <FluentValidationValidator @ref="fluentValidationValidator" />
        <ValidationSummary />
    </Validator>

    <ChildContent>
        <FormItem Label="Name">
            <Input @bind-Value="@context.Name" Placeholder=@Placeholders.EnterWorkflowName/>
        </FormItem>
    </ChildContent>
</Form>

@code {
    private Form<NewWorkflowModel>? form;
    private NewWorkflowModel? workflowModel;
    private FluentValidationValidator fluentValidationValidator;

    protected override void OnInitialized()
    {
        workflowModel = this.Options;
        base.OnInitialized();
    }

    public override async Task OnFeedbackOkAsync(ModalClosingEventArgs args)
    {
        await InvokeAsync(StateHasChanged);
        await Task.Delay(50);

        var valid = fluentValidationValidator.Validate(options => options.IncludeAllRuleSets());
        args.Cancel = !valid;
    }
}