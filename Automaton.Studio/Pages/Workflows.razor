@page "/workflows"
@using Automaton.Studio.Models
@using AntDesign

@if (@WorkflowsViewModel.Workflows == null)
{
    <p><em>Loading...</em></p>
}
else
{
<div>
    <Modal Title="New Workflow"
           Visible="@NewWorkflowVisible"
           OnOk="@NewWorkflowOk"
           OnCancel="@NewWorkflowCancel">
        <Form @ref="form"
              Model="@workflowModel"
              LabelColSpan="8"
              WrapperColSpan="16">
            <FormItem Label="WorkflowName">
                <Input @bind-Value="@context.Name" />
            </FormItem>
        </Form>
    </Modal>

    <Layout>
        <Header Class="header">
            <Space Size="10" Class="actions-bar">
                <SpaceItem>
                    <Button Type="dashed" Icon="plus" @onclick="@(() => ShowNewWorkflowDialog())">
                        New
                    </Button>
                </SpaceItem>
            </Space>
        </Header>

        <Content>
            <Table TItem="WorkflowModel" DataSource="@WorkflowsViewModel.Workflows">
                <Column Title="Workflow" @bind-Field="@context.Name">
                    @context.Name
                </Column>
                <Column @bind-Field="@context.Description"></Column>
                <Column @bind-Field="@context.Version" Width="100">
                    <TitleTemplate>
                        <span> <Icon Type="environment" /> Version </span>
                    </TitleTemplate>
                </Column>

                <Column Title="Runners" @bind-Field="@context.Description" Width="300">
                    <SpaceItem>
                        <Select Mode="multiple"
                                @bind-Values="context.RunnerIds"
                                Placeholder="Select runners..."
                                TItemValue="Guid"
                                TItem="Guid"
                                AllowClear>
                            <SelectOptions>
                                @foreach (var item in @WorkflowsViewModel.Runners)
                                    {
                                    <SelectOption TItemValue="Guid" TItem="Guid" Value=@item.Id Label=@item.Name />
                                    }
                            </SelectOptions>
                        </Select>
                    </SpaceItem>
                </Column>

                <ActionColumn Title="Action">
                    <Space Size="10">
                        <SpaceItem>
                            <Button Type="dashed" Icon="caret-right" @onclick="@(() => RunWorkflow(context))">
                                Run
                            </Button>
                        </SpaceItem>
                        <SpaceItem>
                            <Button Type="dashed" Icon="edit" @onclick="@(() => EditWorkflow(context))">
                                Edit
                            </Button>
                        </SpaceItem>
                    </Space>
                </ActionColumn>

            </Table>
        </Content>
    </Layout>
</div>
}



