@page "/designer"
@page "/designer/{WorkflowId}"
@using Automaton.Studio.Activity
@using Automaton.Studio.Components
@using Automaton.Studio.DragDrop

<Layout>

    <Layout Class="designer-container">
        <Sider Theme="SiderTheme.Light">
            <ActivitiesTree></ActivitiesTree>
        </Sider>

        <Content Class="dropzone-container">
            <Header Class="header">
                <Row>
                    <Col Flex=@("none")>
                    <Space Class="actions-bar">
                        <SpaceItem>
                            <Button Type="dashed" Icon="save" OnClick="SaveWorkflow">
                                Save
                            </Button>
                        </SpaceItem>
                        <SpaceItem>
                            <Button Type="dashed" Icon="caret-right" OnClick="RunWorkflow">
                                Run
                            </Button>
                        </SpaceItem>
                        <SpaceItem>
                            <Select Mode="multiple"
                                    @bind-Values="@DesignerViewModel.SelectedRunnerIds"
                                    Placeholder="Select runners..."
                                    TItemValue="Guid"
                                    TItem="Guid"
                                    Class="runners-select"
                                    AllowClear>
                                <SelectOptions>
                                    @foreach (var item in @DesignerViewModel.Runners)
                                    {
                                        <SelectOption TItemValue="Guid" TItem="Guid" Value=@item.Id Label=@item.Name />
                                    }
                                </SelectOptions>
                            </Select>
                        </SpaceItem>
                    </Space>
                    </Col>

                    @*<Col Class="right-actions">
                        <Space Class="right-header-items">
                            <SpaceItem>
                                <Button Shape="circle" Type="dashed" Icon="setting" Class="action-button"></Button>
                            </SpaceItem>
                        </Space>
                    </Col>*@
                </Row>
            </Header>

            <Dropzone Class="dropzone"
                      @ref="dropzone"
                      TItem="StudioActivity"
                      Items="DesignerViewModel.StudioWorkflow.Activities"
                      InstantReplace="true"
                      OnDropzoneMouseDown="@(()=>OnDropzoneMouseDown())"
                      OnItemDrop="@((p)=>OnActivityDrop(p))"
                      OnItemMouseDown="@((p)=>OnActivityMouseDown(p))">
                <StudioActivityComponent Activity="@context" />
            </Dropzone>
        </Content>

        <Sider Theme=SiderTheme.Light Collapsed=true Class="right-sider">
            <Menu Mode=MenuMode.Inline Theme=MenuTheme.Light Selectable=true Class="right-sider">
                <MenuItem Key="1" Icon="setting" OnClick="OpenWorkflowSettings">
                    Settings
                </MenuItem>
                <MenuItem Key="2" OnClick="OpenWorkflowVariables" Icon="snippets">
                    Variables
                </MenuItem>               
            </Menu>
        </Sider>
    </Layout>
</Layout>

<style>
    .designer-container {
        background-color: #FFF
    }

    .dropzone-container {
        height: calc(100vh - 55px);
    }

    .dropzone {
        height: calc(100vh - 55px);
        overflow: auto;
    }

    .runners-select {
        min-width: 140px;
        max-width: 140px;
    }

    .right-sider {
        max-width: 50px !important;
        min-width: 50px !important;
        background-color: #fafafa;
    }

        .right-sider .ant-menu-item {
            padding-left: 15px !important;
        }
</style>



